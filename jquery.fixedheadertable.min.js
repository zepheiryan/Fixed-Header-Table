/*! Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.4
 * 
 * Requires: 1.2.2+
 */

/*!
 * jquery.fixedHeaderTable. The jQuery fixedHeaderTable plugin
 *
 * Copyright (c) 2011 Mark Malek
 * http://fixedheadertable.com
 *
 * Licensed under MIT
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * http://docs.jquery.com/Plugins/Authoring
 * jQuery authoring guidelines
 *
 * Launch  : October 2009
 * Version : 1.3
 * Released: May 9th, 2011
 *
 * 
 * all CSS sizing (width,height) is done in pixels (px)
 */

(function(c){c.fn.fixedHeaderTable=function(m){var q={width:"100%",height:"100%",themeClass:"fht-default",borderCollapse:!0,fixedColumns:0,fixedColumn:!1,sortable:!1,autoShow:!0,footer:!1,cloneHeadToFoot:!1,autoResize:!1,create:null},b={},n={init:function(a){b=c.extend({},q,a);return this.each(function(){var a=c(this);j._isTable(a)?(n.setup.apply(this,Array.prototype.slice.call(arguments,1)),c.isFunction(b.create)&&b.create.call(this)):c.error("Invalid table mark-up")})},setup:function(){var a=c(this), d=a.find("thead"),e=a.find("tfoot");a.find("tbody");var f,h,l,k=0;b.originalTable=c(this).clone();b.includePadding=j._isPaddingIncludedWithWidth();b.scrollbarOffset=j._getScrollbarWidth();b.themeClassName=b.themeClass;f=-1<b.width.search("%")?a.parent().width()-b.scrollbarOffset:b.width-b.scrollbarOffset;a.css({width:f});a.closest(".fht-table-wrapper").length||(a.addClass("fht-table"),a.wrap('<div class="fht-table-wrapper"></div>'));f=a.closest(".fht-table-wrapper");!0==b.fixedColumn&&0>=b.fixedColumns&& (b.fixedColumns=1);0<b.fixedColumns&&0==f.find(".fht-fixed-column").length&&(a.wrap('<div class="fht-fixed-body"></div>'),c('<div class="fht-fixed-column"></div>').prependTo(f),h=f.find(".fht-fixed-body"));f.css({width:b.width,height:b.height}).addClass(b.themeClassName);a.hasClass("fht-table-init")||a.wrap('<div class="fht-tbody"></div>');l=a.closest(".fht-tbody");var i=j._getTableProps(a);j._setupClone(l,i.tbody,"tbody");a.hasClass("fht-table-init")?h=f.find("div.fht-thead"):(h=0<b.fixedColumns? c('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo(h):c('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo(f),h.find("table.fht-table").addClass(b.originalTable.attr("class")),d.clone().appendTo(h.find("table")));j._setupClone(h,i.thead,"thead");a.css({"margin-top":-h.outerHeight(!0)});!0==b.footer&&(j._setupTableFooter(a,this,i),e.length||(e=f.find("div.fht-tfoot table")),k=e.outerHeight(!0));d=f.height()-d.outerHeight(!0)-k-i.border;l.css({height:d}); a.addClass("fht-table-init");"undefined"!==typeof b.altClass&&n.altRows.apply(this);0<b.fixedColumns&&j._setupFixedColumn(a,this,i);b.autoShow||f.hide();j._bindScroll(l,i);return this},resize:function(){c(this);return this},altRows:function(a){var d=c(this),a="undefined"!==typeof a?a:b.altClass;d.closest(".fht-table-wrapper").find("tbody tr:odd:not(:hidden)").addClass(a)},show:function(a,d,e){var b=c(this),h=b.closest(".fht-table-wrapper");if("undefined"!==typeof a&&"number"===typeof a)return h.show(a, function(){c.isFunction(d)&&d.call(this)}),this;if("undefined"!==typeof a&&"string"===typeof a&&"undefined"!==typeof d&&"number"===typeof d)return h.show(a,d,function(){c.isFunction(e)&&e.call(this)}),this;b.closest(".fht-table-wrapper").show();c.isFunction(a)&&a.call(this);return this},hide:function(a,d,b){var f=c(this),h=f.closest(".fht-table-wrapper");if("undefined"!==typeof a&&"number"===typeof a)return h.hide(a,function(){c.isFunction(b)&&b.call(this)}),this;if("undefined"!==typeof a&&"string"=== typeof a&&"undefined"!==typeof d&&"number"===typeof d)return h.hide(a,d,function(){c.isFunction(b)&&b.call(this)}),this;f.closest(".fht-table-wrapper").hide();c.isFunction(b)&&b.call(this);return this},destroy:function(){var a=c(this),d=a.closest(".fht-table-wrapper");a.insertBefore(d).removeAttr("style").append(d.find("tfoot")).removeClass("fht-table fht-table-init").find(".fht-cell").remove();d.remove();return this}},j={_isTable:function(a){var c=a.is("table"),b=0<a.find("thead").length,a=0<a.find("tbody").length; return c&&b&&a?!0:!1},_bindScroll:function(a){var c=a.closest(".fht-table-wrapper"),e=a.siblings(".fht-thead"),f=a.siblings(".fht-tfoot");a.bind("scroll",function(){0<b.fixedColumns&&c.find(".fht-fixed-column").find(".fht-tbody table").css({"margin-top":-a.scrollTop()});e.find("table").css({"margin-left":-this.scrollLeft});(b.footer||b.cloneHeadToFoot)&&f.find("table").css({"margin-left":-this.scrollLeft})})},_fixHeightWithCss:function(a,c){b.includePadding?a.css({height:a.height()+c.border}):a.css({height:a.outerHeight(!1)+ c.border})},_fixWidthWithCss:function(a,d,e){b.includePadding?a.each(function(){c(this).css({width:void 0==e?c(this).width()+d.border:e+d.border})}):a.each(function(){c(this).css({width:void 0==e?c(this).outerWidth(!1)+d.border:e+d.border})})},_setupFixedColumn:function(a,d,e){var f=a.closest(".fht-table-wrapper"),h=f.find(".fht-fixed-body"),d=f.find(".fht-fixed-column"),l=c('<div class="fht-thead"><table class="fht-table"><thead><tr></tr></thead></table></div>'),k=c('<div class="fht-tbody"><table class="fht-table"><tbody></tbody></table></div>'), i=c('<div class="fht-tfoot"><table class="fht-table"><tfoot><tr></tr></tfoot></table></div>'),g,r=f.width(),m=h.find(".fht-tbody").height()-b.scrollbarOffset;l.find("table.fht-table").addClass(b.originalTable.attr("class"));k.find("table.fht-table").addClass(b.originalTable.attr("class"));i.find("table.fht-table").addClass(b.originalTable.attr("class"));f=h.find(".fht-thead thead tr > *:lt("+b.fixedColumns+")");g=b.fixedColumns*e.border;f.each(function(){g+=c(this).outerWidth(!0)});j._fixHeightWithCss(f, e);j._fixWidthWithCss(f,e);var p=[];f.each(function(){p.push(c(this).width())});l.appendTo(d).find("tr").append(f.clone());k.appendTo(d).css({"margin-top":-1,height:m+e.border});j._getFrozenColumns(a,e,b).appendTo(c("tbody",k));d.css({height:0,width:g});var o=d.find(".fht-tbody .fht-table").height()-d.find(".fht-tbody").height();d.find(".fht-table").bind("mousewheel",function(a,d,b,e){if(0!=e)return a=parseInt(c(this).css("marginTop"),10)+(0<e?120:-120),0<a&&(a=0),a<-o&&(a=-o),c(this).css("marginTop", a),h.find(".fht-tbody").scrollTop(-a).scroll(),!1});h.css({width:r});if(!0==b.footer||!0==b.cloneHeadToFoot)a=h.find(".fht-tfoot tr > *:lt("+b.fixedColumns+")"),j._fixHeightWithCss(a,e),i.appendTo(d).find("tr").append(a.clone()),footwidth=i.find("table").innerWidth(),i.css({top:b.scrollbarOffset,width:footwidth})},_setupTableFooter:function(a,d,e){var d=a.closest(".fht-table-wrapper"),f=a.find("tfoot"),a=d.find("div.fht-tfoot");a.length||(a=0<b.fixedColumns?c('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo(d.find(".fht-fixed-body")): c('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo(d));a.find("table.fht-table").addClass(b.originalTable.attr("class"));switch(!0){case !f.length&&!0==b.cloneHeadToFoot&&!0==b.footer:e=d.find("div.fht-thead");a.empty();e.find("table").clone().appendTo(a);break;case f.length&&!1==b.cloneHeadToFoot&&!0==b.footer:a.find("table").append(f).css({"margin-top":-e.border}),j._setupClone(a,e.tfoot,"tfoot")}},_getTableProps:function(a){var d={thead:{},tbody:{},tfoot:{},border:0}, e=1;!0==b.borderCollapse&&(e=2);d.border=(a.find("th:first-child").outerWidth()-a.find("th:first-child").innerWidth())/e;a.find("thead tr > *").each(function(a){d.thead[a]=c(this).width()+d.border});a.find("tfoot tr > *").each(function(a){d.tfoot[a]=c(this).width()+d.border});a.find("tbody tr:first-child > *").each(function(a){d.tbody[a]=c(this).width()+d.border});return d},_setupClone:function(a,d,e){var f;a.find(e+("tbody"===e?" tr:first-child > *":" tr > *")).each(function(a){f=c(this).find("div.fht-cell").length? c(this).find("div.fht-cell"):c('<div class="fht-cell"></div>').appendTo(c(this));f.css({width:parseInt(d[a])});!c(this).closest(".fht-tbody").length&&(c(this).is(":last-child")&&!c(this).closest(".fht-fixed-column").length)&&(a=(c(this).innerWidth()-c(this).width())/2+b.scrollbarOffset,c(this).css({"padding-right":a+"px"}))})},_isPaddingIncludedWithWidth:function(){var a=c('<table class="fht-table"><tr><td style="padding: 10px; font-size: 10px;">test</td></tr></table>'),d,e;a.addClass(b.originalTable.attr("class")); a.appendTo("body");d=a.find("td").height();a.find("td").css("height",a.find("tr").height());e=a.find("td").height();a.remove();return d!=e?!0:!1},_getScrollbarWidth:function(){var a=0;if(!a)if(c.browser.msie){var d=c('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body"),b=c('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body"),a=d.width()-b.width()+2;d.add(b).remove()}else d= c("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1E3,left:-1E3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200}),a=100-d.width(),d.parent().remove();return a},_getFrozenColumns:function(a,b,e){var f=c("<tbody></tbody>"),a=c("tbody",a),h,l,k,i,g,j,m,p,o,n,b=c("tr",a).length;l=0;c("tr:eq(0) > *",a).each(function(a,b){i=c(b).attr("colspan");l="undefined"!==typeof i?l+parseInt(i,10):l+1});h=Array(b);for(g=0;g<b;g++)h[g]=Array(l);c("tr",a).each(function(a, b){c("td, th",b).each(function(b,d){k=c(d).attr("rowspan");i=c(d).attr("colspan");k="undefined"===typeof k?k=1:k=parseInt(k,10);i="undefined"===typeof i?i=1:i=parseInt(i,10);for(g=0;g<l;g++)"undefined"===typeof h[a][g]&&(m=g,g=l);h[a][m]={element:!0,rowspan:k,colspan:i};if(1<k||1<i)for(g=0;g<k;g++)for(j=0;j<i;j++)if(0<g||0<j&&!(0===g&&0===j))h[a+g][m+j]={element:!1,rowspan:k-g,colspan:i-j}})});c("tr",a).each(function(a,b){p=c("<tr>");e.altClass&&c(b).hasClass(e.altClass)&&p.addClass(e.altClass);for(g= n=0;g<e.fixedColumns;g++)h[a][g].element&&n++;for(g=0;g<n;g++)o=c("td, th",b).eq(g).clone(),e.includePadding?o.css("width",c("td, th",b).eq(g).width()).css("height",c("td, th",b).eq(g).height()):o.css("width",c("td, th",b).eq(g).width()).css("height",c("td, th",b).eq(g).parent().height()),p.append(o);f.append(p)});return f.contents()}};if(n[m])return n[m].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof m||!m)return n.init.apply(this,arguments);c.error('Method "'+m+'" does not exist in fixedHeaderTable plugin!')}})(jQuery);
